<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>طلب نقل مريض</title>
<style>
  body {font-family: Arial, Tahoma, sans-serif; background:#eef2f3; margin:0; min-height:100vh;
        display:flex; align-items:center; justify-content:center;}
  .card {background:#fff; padding:28px; width:420px; max-width:94%; border-radius:12px;
         box-shadow:0 6px 18px rgba(0,0,0,0.08); text-align:center;}
  h2 {margin:0 0 14px 0; font-size:20px;}
  input, select, button {width:100%; padding:12px; margin-top:10px; font-size:15px; border-radius:8px;
                         border:1px solid #cfcfcf; box-sizing:border-box;}
  select {appearance:none;}
  button {background:#0077cc; color:#fff; border:none; cursor:pointer;}
  button[disabled]{opacity:0.6; cursor:not-allowed;}
  #msg {min-height:22px; margin-top:12px; font-weight:600;}
  #msg.success {color:green;}
  #msg.error {color:#c00;}
  .small {font-size:13px; color:#666; margin-top:6px;}
</style>
</head>
<body>

<div class="card" role="main" aria-labelledby="title">
  <h2 id="title">طلب نقل مريض</h2>

  <input id="patient_name" type="text" placeholder="اسم المريض" autocomplete="off" />
  <input id="patient_id" type="text" placeholder="رقم المريض (اختياري)" autocomplete="off" />

  <select id="from_dep" aria-label="المصلحة الحالية">
    <option value="">اختر المصلحة الحالية</option>
    <option value="">اختر المصلحة الحالية</option>
        <option>الاستعجالات</option>
        <option>الطب الداخلي</option>
        <option>الإنعاش</option>
        <option>مصلحة جراحة الاوعية  والشرايين</option>
        <option>مصلحة أمراض الكلى</option>
        <option>مصلحة أمراض الدم</option>
        <option>مصلحة الامراض التنفسية</option>
        <option>مصلحة الامراض المعدية</option>
        <option>مصلحة الانعاش الجراحي</option>
        <option>مصلحة  الانعاش الطبي</option>
        <option>مصلحة جراحة العظام</option>
        <option>مصلحة المسالك البولية</option> 
        <option>مصلحة أمراض القلب</option>
        <option>مصلحة جراحة الرجال</option>
        <option>مصلحة جراحة النساء</option>
        <option>مصلحة جراحة الاطفال</option>
  </select>

  <select id="to_dep" aria-label="المصلحة المطلوبة">
    <option value="">اختر المصلحة المطلوبة</option>
<option value="">اختر المصلحة الحالية</option>
        <option>الاستعجالات</option>
        <option>الطب الداخلي</option>
        <option>الإنعاش</option>
        <option>مصلحة جراحة الاوعية  والشرايين</option>
        <option>مصلحة أمراض الكلى</option>
        <option>مصلحة أمراض الدم</option>
        <option>مصلحة الامراض التنفسية</option>
        <option>مصلحة الامراض المعدية</option>
        <option>مصلحة الانعاش الجراحي</option>
        <option>مصلحة  الانعاش الطبي</option>
        <option>مصلحة جراحة العظام</option>
        <option>مصلحة المسالك البولية</option> 
        <option>مصلحة أمراض القلب</option>
        <option>مصلحة جراحة الرجال</option>
        <option>مصلحة جراحة النساء</option>
        <option>مصلحة جراحة الاطفال</option>
  </select>

  <div id="msg" aria-live="polite"></div>

  <button id="sendBtn" onclick="sendRequest()">إرسال الطلب</button>
  <div class="small">تأكد من صحة المعلومات قبل الإرسال.</div>
</div>

<script>
  async function sendRequest(){
    const btn = document.getElementById('sendBtn');
    const msg = document.getElementById('msg');

    const patient_name = document.getElementById('patient_name').value.trim();
    const patient_id = document.getElementById('patient_id').value.trim();
    const from_dep = document.getElementById('from_dep').value;
    const to_dep = document.getElementById('to_dep').value;

    // تحقق بسيط
    if(!patient_name){
      msg.className = "error";
      msg.innerText = "رجاءً أدخل اسم المريض.";
      return;
    }
    if(!from_dep || !to_dep){
      msg.className = "error";
      msg.innerText = "رجاءً اختر المصلحة الحالية والمراد الانتقال إليها.";
      return;
    }
    if(from_dep === to_dep){
      msg.className = "error";
      msg.innerText = "المصلحة الحالية والمراد نفسهما — اختر مصلحة مختلفة.";
      return;
    }

    // منع الإرسال المتكرر
    btn.disabled = true;
    const originalText = btn.innerText;
    btn.innerText = "جاري الإرسال...";

    try {
      const res = await fetch("/create_request", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ patient_name, patient_id, from_dep, to_dep })
      });

      const data = await res.json();

      if(res.ok){
        msg.className = "success";
        msg.innerText = data.message || "تم إرسال الطلب بنجاح.";
        btn.innerText = "تأكيد الطلب";
        // يمكنك هنا إفراغ الحقول إن رغبت:
        // document.getElementById('patient_name').value = "";
      } else {
        msg.className = "error";
        msg.innerText = data.message || ("خطأ: " + (data.detail || res.status));
        btn.innerText = originalText;
        btn.disabled = false;
      }
    } catch (e) {
      msg.className = "error";
      msg.innerText = "خطأ في الاتصال. تأكد من الإنترنت وحاول مرة أخرى.";
      btn.innerText = originalText;
      btn.disabled = false;
    }
  }
</script>

</body>
</html>